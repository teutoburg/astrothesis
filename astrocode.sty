\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{astrocode}[2022/01/02 listing style package for python and yaml]

\RequirePackage{listings}

%New colors defined below
\definecolor{codegreen}{rgb}{0,.55,0}
\definecolor{codegray}{rgb}{.5,.5,.5}
\definecolor{codepurple}{rgb}{.58,0,.82}
\definecolor{codeorange}{rgb}{.9,.5,.3}
\definecolor{codeblue}{rgb}{.1,.1,.8}
\definecolor{codeblack}{rgb}{0,0,0}
\definecolor{codered}{rgb}{.8,.2,.2}
\definecolor{backcolour}{rgb}{.95,.95,.92}

%Code listing style named "mystyle"
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codeblue},
    morecomment=[s][\color{codegreen}]{"""}{"""},
    keywordstyle=\color{codepurple},
    numberstyle=\small\color{codegray},
    stringstyle=\color{codegreen},
    identifierstyle=,
    emph={None},
    emphstyle=\color{codeorange},
    emph={self, cls, @property},
    emphstyle=\color{codered},
    basicstyle=\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
}

\newcommand\YAMLcolonstyle{\color{red}\mdseries}
\newcommand\YAMLkeystyle{\color{black}\bfseries}
\newcommand\YAMLvaluestyle{\color{blue}\mdseries}

\makeatletter

% here is a macro expanding to the name of the language
% (handy if you decide to change it further down the road)
\newcommand\language@yaml{yaml}

\expandafter\expandafter\expandafter\lstdefinelanguage
\expandafter{\language@yaml}
{
  keywords={true,false,null,y,n},
  keywordstyle=\color{darkgray}\bfseries,
  basicstyle=\YAMLkeystyle,                                 % assuming a key comes first
  sensitive=false,
  comment=[l]{\#},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{purple}\ttfamily,
  stringstyle=\YAMLvaluestyle\ttfamily,
  moredelim=[l][\color{orange}]{\&},
  moredelim=**[il][\YAMLcolonstyle{:}\YAMLvaluestyle]{:},   % switch to value style at :
  morestring=[b]',
  morestring=[b]",
  literate =    {---}{{\ProcessThreeDashes}}3
                {>}{{\textcolor{red}\textgreater}}1
                {|}{{\textcolor{red}\textbar}}1
                {\ -\ }{{\mdseries\ -\ }}3,
}

% switch to key style at EOL
\lst@AddToHook{EveryLine}{\ifx\lst@language\language@yaml\YAMLkeystyle\fi}
\makeatother

\newcommand\ProcessThreeDashes{\llap{\color{cyan}\mdseries-{-}-}}


%"mystyle" code listing set
\lstset{language=Python}
\lstset{style=mystyle}

\newcommand{\lstheading}[1]{\protect\texttt{#1}}
